# =============================================================================
# Additional Nginx Security Configuration
# Included by main nginx.conf
# =============================================================================

# Hide nginx version
server_tokens off;

# Limit request methods
if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE|OPTIONS)$) {
    return 405;
}

# Limit connection rate
# limit_conn_zone $binary_remote_addr zone=addr:10m;
# limit_conn addr 10;

# Additional security for common attacks
# Block SQL injection attempts
if ($query_string ~* "union.*select.*\(") {
    return 403;
}

if ($query_string ~* "concat.*\(") {
    return 403;
}

# Block XSS attempts
if ($query_string ~* "<script") {
    return 403;
}

if ($query_string ~* "javascript:") {
    return 403;
}

# Block common exploits
if ($query_string ~* "base64_(en|de)code[^(]*\(") {
    return 403;
}

if ($query_string ~* "GLOBALS(=|\[|\%[0-9A-Z]{0,2})") {
    return 403;
}

if ($query_string ~* "_REQUEST(=|\[|\%[0-9A-Z]{0,2})") {
    return 403;
}

# Block access to sensitive WordPress files (if WP is used elsewhere)
if ($uri ~* "^(?:/\.htaccess|/\.htpasswd|/wp-config\.php|/wp-admin/install\.php)") {
    return 403;
}
